import yara

class YaraRules:
    """
    Module where the user can create or load his yara rules 
    to pass them to the different samples.
    """
    def run(self, sample_path, saved_sample_name):

        # Define the rule as a string
        rule_source = """
        rule simple_string_contains
        {
            strings:
                $a = "pollute"
            condition:
                $a
        }
        """

        # Compile the rule
        rules = yara.compile(source=rule_source)

        # Define a dictionary to hold the scan results
        matches = {}

        # Scan a file
        with open(sample_path, "rb") as f:
            matches = rules.match(data=f.read())

        if not matches:
            raise Exception("No rule matches with -> " + sample_path)
        
        # Print the match results
        for match in matches:
            print(f"[+] Rule match ({match.rule}):")
            for string in match.strings:
                print(f" - {string}")
        

